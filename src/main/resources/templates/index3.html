<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø¨Ø­Ø« ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙƒØ§Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body style="direction: rtl; font-family: 'Cairo', sans-serif; background-color: #f7f7f7;">

    <!-- Ø´Ø¹Ø§Ø± -->
    <div class="text-center mt-4">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJvx2DbwqubWZe9dornV-C_qM5VW6AAcmNyA&s" alt="Logo">
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="navbar navbar-expand-lg navbar-dark mt-4" style="background-color: rgb(64, 128, 120);">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav"
                    aria-expanded="false" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ†Ù‚Ù„">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto text-end">
                    <li class="nav-item">
                        <a class="nav-link text-white fw-semibold" th:href="@{/archive/index2}">Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fw-semibold" th:href="@{/}">Ø¥Ø¶Ø§ÙØ©</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø­Ø« -->
    <h2 class="text-center mt-5 text-success" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">
        <b>Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø¨Ø§Ù„Ø±Ù…Ø²</b>
    </h2>

    <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« -->
    <div class="d-flex justify-content-center mt-4">
        <div class="input-group mb-4 shadow-sm" style="width: 50%;">
            <input type="text" id="searchQuery" class="form-control rounded-start border-primary" 
                   placeholder="ğŸ” Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ" style="font-size: 1.1rem;">
            <button onclick="searchRecords()" class="btn btn-outline-primary px-4">Ø¨Ø­Ø«</button>
        </div>
    </div>

    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
    <div class="container">
        <div id="resultsContainer" class="text-center">
            <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</p>
        </div>
    </div>

    <!-- Ø§Ù„Ø³ÙƒØ±Ø¨Øª -->
    <script>
        $(document).ready(function() {
            $("#searchQuery").keypress(function(event) {
                if (event.which === 13) {
                    event.preventDefault();
                    searchRecords();
                }
            });
        });

        function searchRecords() {
            let query = $("#searchQuery").val().trim();
            if (query === "") return;

            $.ajax({
                type: "GET",
                url: "/archive/search",
                data: { query: query },
                success: function(data) {
                    let resultsContainer = $("#resultsContainer");
                    resultsContainer.empty();

                    if (data.length === 0) {
                        resultsContainer.append(`<p class="text-danger fw-bold">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€: "<span class="text-dark">${query}</span>"</p>`);
                        return;
                    }

                    let pageSize = 9;
                    let currentPage = 1;
                    let totalPages = Math.ceil(data.length / pageSize);

                    function renderPage(page) {
                        let start = (page - 1) * pageSize;
                        let end = start + pageSize;
                        let pageData = data.slice(start, end);

                        let tableHtml = `
                            <p class="text-success fw-bold mb-3">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ <span class="text-primary">${data.length}</span> Ø¬Ù‡Ø§Øª Ù„Ù€: "<span class="text-dark">${query}</span>"</p>
                            <table class="table table-striped table-bordered">
                                <thead style="background-color: #0d6efd; color: white; text-align: center;">
                                    <tr>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</th>
                                        <th>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</th>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙÙˆØ¶</th>
                                        <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ</th>
                                    </tr>
                                </thead>
                                <tbody>`;

                        pageData.forEach(record => {
                            tableHtml += `
                                <tr>
                                    <td class="text-center align-middle">${record.companyName}</td> 
                                    <td class="text-center align-middle">${record.statisticalNumber}</td>
                                    <td class="text-center align-middle">${record.commissionername}</td>
                                    <td class="text-center align-middle">${record.nationalId}</td>
                                </tr>`;
                        });

                        tableHtml += `</tbody></table>`;

                        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ­Ø§Øª
                        let pagination = `<nav><ul class="pagination justify-content-center">`;
                        for (let i = 1; i <= totalPages; i++) {
                            pagination += `<li class="page-item ${i === page ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>
                            </li>`;
                        }
                        pagination += `</ul></nav>`;

                        resultsContainer.html(tableHtml + pagination);
                    }

                    window.goToPage = function(page) {
                        currentPage = page;
                        renderPage(currentPage);
                    }

                    renderPage(currentPage);
                },
                error: function() {
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.");
                }
            });
        }
    </script>

</body>
</html>
